# Конфигурация генетического алгоритма

genetic_algorithm:
  # Параметры популяции
  population_size: 100  # Рекомендация DeepSeek: 100-150 для 50+ параметров
  max_generations: 100
  
  # Параметры операторов (фиксированные первые 20 поколений)
  crossover_rate: 0.75  # Рекомендация DeepSeek: 0.75 для первых 20 поколений
  mutation_rate: 0.15   # Рекомендация DeepSeek: 0.15 для первых 20 поколений
  elite_size: 5
  
  # Параметры селекции
  selection_method: tournament  # tournament или roulette
  tournament_size: 3
  
  # Критерии остановки
  stagnation_limit: 20  # Поколений без улучшения
  target_fitness: 200.0  # Целевая приспособленность
  
  # Адаптивные параметры (активируются после fixed_generations)
  adaptive_mutation: true  # Адаптивная мутация при застое
  adaptive_crossover: true  # Адаптивный кроссовер (включен по рекомендации)
  fixed_generations: 20  # Первые 20 поколений с фиксированными параметрами
  adaptive_mutation_max: 0.25  # Максимальная мутация при низкой diversity
  adaptive_crossover_max: 0.85  # Максимальный кроссовер при stagnation
  
  # Параллелизация
  use_parallel: true
  n_jobs: 4  # Количество процессов

# Параметры функции приспособленности
fitness:
  # Веса метрик (обновлено по рекомендации DeepSeek)
  weights:
    pnl: 0.35         # Снижен с 0.5 (было 50%, стало 35%)
    sharpe_ratio: 0.25 # Увеличен с 0.2 (было 20%, стало 25%)
    max_drawdown: 0.20 # Увеличен с 0.15 (было 15%, стало 20%)
    win_rate: 0.10     # Без изменений (10%)
    profit_factor: 0.10 # Увеличен с 0.05 (было 5%, стало 10%)
  
  # Нормализация
  normalization_method: rank_based  # Рекомендация DeepSeek: rank-based вместо absolute
  
  # Бонусы
  bonuses:
    sharpe_above_1: 20
    sharpe_above_2: 30
    drawdown_below_20: 15
    drawdown_below_10: 25
    win_rate_above_50: 10
    profit_factor_above_2: 15
  
  # Штрафы (мультипликативные по рекомендации DeepSeek)
  penalties:
    trades_below_10: 0.5   # Минимальное количество сделок (обновлено)
    trades_below_20: 0.7   # Штраф за мало сделок
    drawdown_above_40: 0.5  # Штраф за просадку > 40% (обновлено)
    drawdown_above_50: 0.3  # Сильный штраф за просадку > 50%
    win_rate_below_30: 0.7  # Штраф за низкий win rate
    profit_factor_below_1: 0.7  # Штраф за убыточную стратегию
    sharpe_below_0: 0.3     # Штраф за отрицательный Sharpe (новый)

# Параметры бэктестинга
backtest:
  initial_capital: 10000
  commission: 0.001  # 0.1% комиссия
  slippage: 0.0005   # 0.05% проскальзывание
  
  # Разделение данных
  train_split: 0.7   # 70% для обучения
  val_split: 0.15    # 15% для валидации
  test_split: 0.15   # 15% для тестирования

# Пространство поиска параметров (MVP)
search_space:
  rsi_period:
    type: int
    min: 10
    max: 25
  stop_loss_pct:
    type: float
    min: 0.005
    max: 0.02
  take_profit_pct:
    type: float
    min: 0.01
    max: 0.05
  atr_period:
    type: int
    min: 8
    max: 28
  atr_stop_multiplier:
    type: float
    min: 1.0
    max: 3.0
  atr_trailing_multiplier:
    type: float
    min: 0.5
    max: 2.0
  wobi_weight:
    type: float
    min: 0.1
    max: 0.5
  time_filter_enabled:
    type: int
    min: 0
    max: 1
    # 0 = фильтр выключен (торгуем весь день)
    # 1 = фильтр включен (торгуем только в выбранном окне)
  time_window_start:
    type: int
    min: 0
    max: 23
    # Начало разрешённого окна (часы UTC, 0-23)
    # Используется только если time_filter_enabled = 1
  time_window_length:
    type: int
    min: 1
    max: 12
    # Длина окна в часах (1-12 часов)
    # Используется только если time_filter_enabled = 1
    # Конец окна = start + length (не более 24)
  long_signal_multiplier:
    type: float
    min: 0.8
    max: 1.2
    # Множитель для long сигналов (оптимизируется ГА)
    # Используется для балансировки Long/Short позиций
    # ОГРАНИЧЕНО: [0.8, 1.2] вместо [0.5, 1.5] для предотвращения "лазеек"
  short_signal_multiplier:
    type: float
    min: 0.8
    max: 1.2
    # Множитель для short сигналов (оптимизируется ГА)
    # Используется для балансировки Long/Short позиций
    # ОГРАНИЧЕНО: [0.8, 1.2] вместо [0.5, 1.5] для предотвращения "лазеек"
    # CONSTRAINT: long_signal_multiplier + short_signal_multiplier >= 1.6
  entry_threshold_long:
    type: float
    min: 0.5
    max: 0.7
    # Порог входа для long позиций (оптимизируется ГА)
    # Более строгий порог для long (требует более сильных сигналов)
    # ОГРАНИЧЕНО: [0.5, 0.7] вместо [0.5, 0.8] для более строгих входов
    # CONSTRAINT: entry_threshold_long >= entry_threshold_short
  entry_threshold_short:
    type: float
    min: 0.4
    max: 0.6
    # Порог входа для short позиций (оптимизируется ГА)
    # Более мягкий порог для short (приоритет шортов)
    # ОГРАНИЧЕНО: [0.4, 0.6] вместо [0.3, 0.6] для повышения минимального порога
  
  # Веса индикаторов (оптимизируются ГА)
  rsi_weight:
    type: float
    min: 0.1
    max: 2.0
    # Вес RSI индикатора в голосовании
  macd_weight:
    type: float
    min: 0.1
    max: 2.0
    # Вес MACD индикатора в голосовании
  bollinger_weight:
    type: float
    min: 0.1
    max: 2.0
    # Вес Bollinger Bands индикатора в голосовании
  
  # Пороги RSI отдельно для long/short (оптимизируются ГА)
  rsi_buy_below_long:
    type: float
    min: 25.0
    max: 40.0
    # Порог RSI для входа в long позицию (чем ниже, тем строже)
  rsi_sell_above_short:
    type: float
    min: 55.0
    max: 75.0
    # Порог RSI для входа в short позицию (чем выше, тем строже)
  
  # Параметры MACD (оптимизируются ГА)
  macd_fast_period:
    type: int
    min: 5
    max: 30
    # Быстрый период MACD
  macd_slow_period:
    type: int
    min: 15
    max: 70
    # Медленный период MACD
  macd_signal_period:
    type: int
    min: 5
    max: 30
    # Период сигнальной линии MACD
  
  # Параметры Bollinger Bands (оптимизируются ГА)
  bollinger_period:
    type: int
    min: 15
    max: 40
    # Период Bollinger Bands
  bollinger_std_dev:
    type: float
    min: 1.5
    max: 4.0
    # Стандартное отклонение для Bollinger Bands
  
  # Параметры WOBI (веса глубин, оптимизируются ГА)
  wobi_weight_ratio3:
    type: float
    min: 0.0
    max: 1.0
    # Вес глубины 3% для WOBI
  wobi_weight_ratio5:
    type: float
    min: 0.0
    max: 1.0
    # Вес глубины 5% для WOBI
  wobi_weight_ratio8:
    type: float
    min: 0.0
    max: 1.0
    # Вес глубины 8% для WOBI
  wobi_weight_ratio60:
    type: float
    min: 0.0
    max: 1.0
    # Вес глубины 60% для WOBI
    # CONSTRAINT: сумма всех wobi_weight_ratio* должна быть близка к 1.0 (нормализуется в коде)

