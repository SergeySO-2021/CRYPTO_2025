# Детальный анализ результатов ГА №3 (100×100, досрочная остановка)

**Дата эксперимента:** 18 ноября 2025  
**Конфигурация:** population=100, max_generations=100, досрочная остановка на поколении 16  
**Fitness:** 200.85 (целевой 200.0 достигнут)

## Использованные улучшения

1. **Fitness функция на основе validation метрик** с штрафами за переобучение
2. **Параллелизация** через pathos (4 процесса)
3. **Early stopping** при достижении target_fitness=200.0
4. **Оптимизация временного окна** (0-23 часа, длина 1-12 часов)

## Найденные оптимальные параметры

| Параметр | Значение | Комментарий |
|----------|----------|-------------|
| RSI период | **15** | Средний период, близок к классическому 14 |
| Stop Loss | **1.47%** | Умеренный стоп-лосс |
| Take Profit | **1.21%** | Немного меньше SL (соотношение 1.21:1) |
| ATR период | **23** | Длинный период для сглаживания волатильности |
| ATR Stop Multiplier | **1.0** | Базовый множитель для ATR стопов |
| ATR Trailing Multiplier | **1.96** | Высокий множитель для агрессивного trailing stop |
| WOBI вес | **0.38** | Средний вес, индикатор активно используется |
| Time filter enabled | **1** (включён) | Фильтр времени критически важен |
| Time window start | **18:00 UTC** | Вечернее время (21:00 МСК) |
| Time window length | **3 часа** | Узкое окно: 18:00–21:00 UTC |

### Анализ параметров

**Соотношение SL/TP:** 1.21:1 — сбалансированное, не слишком агрессивное и не слишком консервативное.

**Временное окно:** 18:00–21:00 UTC (21:00–00:00 МСК) — узкое окно в вечернее время. Это может быть связано с:
- Высокой ликвидностью в это время
- Особенностями поведения рынка в вечерние часы
- Снижением волатильности после дневной торговли

**ATR параметры:** Длинный период (23) и высокий trailing multiplier (1.96) говорят о том, что стратегия использует долгосрочные тренды волатильности для управления рисками.

## Метрики по срезам

### Сводная таблица

| Split | Total PnL | Return | Sharpe | Max DD | Win Rate | Profit Factor | Trades |
|-------|-----------|--------|--------|--------|----------|---------------|--------|
| **Train** | +664 USDT | **+6.64%** | **7.89** | 5.74% | 41.6% | 1.13 | 161 |
| **Val** | **+736 USDT** | **+7.36%** | **42.65** | 2.77% | 46.7% | **2.06** | 30 |
| **Test** | **+402 USDT** | **+4.02%** | **26.27** | 3.06% | **53.6%** | **1.48** | 28 |
| **Full** | **+1,909 USDT** | **+19.09%** | **15.02** | 5.74% | 43.8% | 1.28 | 219 |

### Детальный анализ по срезам

#### Train (обучение) — 161 сделка

**Общая статистика:**
- Long позиции: 1 (0.6%)
- Short позиции: 160 (99.4%)

**Результаты:**
- Прибыльных: 67 (41.6%)
- Убыточных: 94 (58.4%)
- Средний PnL: 4.12
- Медианный PnL: -11.36
- Средний выигрыш: 85.50
- Максимальный выигрыш: 349.25
- Средний проигрыш: -53.87
- Максимальный проигрыш: -200.26

**По направлениям:**
- Long Win Rate: 100.0% (1 сделка)
- Long средний PnL: 166.99
- Short Win Rate: 41.2%
- Short средний PnL: 3.11

**Длительность удержания:**
- Средняя: 3.14 часа
- Медианная: 2.50 часа
- Минимальная: 0.25 часа
- Максимальная: 9.50 часов

#### Val (валидация) — 30 сделок

**Общая статистика:**
- Long позиции: 1 (3.3%)
- Short позиции: 29 (96.7%)

**Результаты:**
- Прибыльных: 14 (46.7%)
- Убыточных: 16 (53.3%)
- Средний PnL: 24.53
- Медианный PnL: -4.30
- Средний выигрыш: 101.93
- Максимальный выигрыш: 211.95
- Средний проигрыш: -43.20
- Максимальный проигрыш: -103.78

**По направлениям:**
- Long Win Rate: 0.0% (1 сделка)
- Long средний PnL: -15.92
- Short Win Rate: 48.3%
- Short средний PnL: 25.93

**Длительность удержания:**
- Средняя: 2.63 часа
- Медианная: 2.25 часа
- Минимальная: 0.75 часа
- Максимальная: 6.25 часов

#### Test (тест) — 28 сделок

**Общая статистика:**
- Long позиции: 0 (0.0%)
- Short позиции: 28 (100.0%)

**Результаты:**
- Прибыльных: 15 (53.6%) — **лучший показатель!**
- Убыточных: 13 (46.4%)
- Средний PnL: 14.36
- Медианный PnL: 11.09
- Средний выигрыш: 82.27
- Максимальный выигрыш: 158.84
- Средний проигрыш: -64.01
- Максимальный проигрыш: -120.40

**По направлениям:**
- Short Win Rate: 53.6%
- Short средний PnL: 14.36

**Длительность удержания:**
- Средняя: 3.12 часа
- Медианная: 2.00 часа
- Минимальная: 0.75 часа
- Максимальная: 9.50 часов

## Ключевые наблюдения

### ✅ Положительные аспекты

1. **Нет переобучения:** Val метрики лучше Train (Sharpe 42.65 vs 7.89), что указывает на хорошую обобщающую способность стратегии.

2. **Стабильность на тесте:** Test показывает доходность 4.02% с Win Rate 53.6% и Sharpe 26.27. Разница с Val по доходности 45.4%, но Sharpe стабилен (разница 38.4%).

3. **Высокий Sharpe:** Sharpe 42.65 на валидации и 26.27 на тесте — отличные показатели стабильности доходности.

4. **Рост Win Rate:** Win Rate растёт от Train (41.6%) → Val (46.7%) → Test (53.6%), что указывает на улучшение качества сигналов.

5. **Низкий Drawdown:** Max Drawdown на Val (2.77%) и Test (3.06%) — отличные показатели управления рисками.

6. **Early stopping эффективен:** ГА достиг целевого fitness (200.0) уже на 16-м поколении, что говорит об эффективности оптимизации.

### ⚠️ Области для улучшения

1. **Почти полностью Short-ориентированная стратегия:** 99%+ сделок — Short позиции. Это может быть связано с:
   - Асимметричными весами в конфиге (short_signal_multiplier=1.2, long_signal_multiplier=0.8)
   - Особенностями выбранного временного окна (18:00–21:00 UTC)
   - Паттернами рынка в этот период
   
   **Рекомендация:** Исследовать возможность оптимизации весов long/short сигналов через ГА.

2. **Разница доходности Val/Test:** Разница 45.4% может указывать на некоторую нестабильность. Однако Sharpe стабилен, что говорит о том, что стратегия работает, но с разной доходностью.

3. **Узкое временное окно:** Окно всего 3 часа может ограничивать количество возможных сделок. Стоит исследовать, можно ли расширить окно без потери качества.

## Сравнение с предыдущими запусками

| Параметр | ГА №1 (40×50) | ГА №2 (40×50) | ГА №3 (100×100) |
|----------|---------------|---------------|-----------------|
| Fitness | 137.96 | 85.92 | **200.85** |
| Val Return | +1.7% | +4.55% | **+7.36%** |
| Val Sharpe | 9.0 | 18.1 | **42.65** |
| Test Return | +4.2% | -0.60% | **+4.02%** |
| Test Sharpe | 24.7 | -1.47 | **26.27** |
| Временное окно | Нет | 12:00–16:00 UTC | **18:00–21:00 UTC** |
| Переобучение | Есть (train -32.1%) | Есть (train -13.3%) | **Нет (train +6.64%)** |
| Win Rate Test | 39.0% | 33.3% | **53.6%** |

**Вывод:** Новая fitness функция с штрафами за переобучение и оптимизация временного окна значительно улучшили результаты. Стратегия теперь прибыльна на всех срезах и показывает стабильные метрики.

## Рекомендации для следующих экспериментов

1. **Оптимизация весов long/short сигналов:** Добавить `long_signal_multiplier` и `short_signal_multiplier` в search space ГА.

2. **Исследование расширения временного окна:** Проверить, можно ли расширить окно до 4-6 часов без потери качества.

3. **Анализ паттернов Short позиций:** Исследовать, почему стратегия предпочитает Short позиции, и можно ли улучшить Long сигналы.

4. **Оптимизация порогов входа:** Добавить `entry_threshold_long` и `entry_threshold_short` в search space для асимметричной оптимизации.

5. **Исследование других временных окон:** Проверить, есть ли другие временные окна, которые могут дать лучшие результаты.

## Файлы с результатами

- **Результаты ГА:** `results/ga_best.json`
- **Скрипт детального анализа:** `scripts/analyze_ga_results.py`
- **Конфигурация ГА:** `config/ga_config.yaml`
- **Конфигурация стратегии:** `config/mvp_strategy_config.yaml`

---

**Дата создания:** 18 ноября 2025  
**Автор:** Генетический алгоритм оптимизации  
**Статус:** ✅ Успешно завершён

