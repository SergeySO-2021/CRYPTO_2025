# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Fitness —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±–æ—Ä—å–±—ã —Å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ–º

**–î–∞—Ç–∞:** 17 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –±–æ–µ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ì–ê (40√ó50) –≤—ã—è–≤–∏–ª–æ—Å—å **—è–≤–Ω–æ–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ**:
- **Train:** -32.1% (Sharpe -63.1) ‚ùå
- **Val:** +1.7% (Sharpe 9.0) ‚úÖ
- **Test:** +4.2% (Sharpe 24.7) ‚úÖ

–ì–ê –º–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ train, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—é –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculate_fitness` –≤ `src/core/genetic_optimizer.py`:

### 1. –û—Å–Ω–æ–≤–Ω–æ–π fitness –Ω–∞ validation

**–î–æ:** Fitness –≤—ã—á–∏—Å–ª—è–ª—Å—è –Ω–∞ train –º–µ—Ç—Ä–∏–∫–∞—Ö  
**–ü–æ—Å–ª–µ:** Fitness –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ **validation** –º–µ—Ç—Ä–∏–∫–∞—Ö

```python
# –û—Å–Ω–æ–≤–Ω–æ–π fitness –Ω–∞ validation (–±–æ—Ä—å–±–∞ —Å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ–º)
pnl_score = val_metrics["total_return"] * 100
sharpe_score = val_metrics["sharpe_ratio"] * 10
# ... –∏ —Ç.–¥.
```

### 2. –®—Ç—Ä–∞—Ñ –∑–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculate_overfitting_penalty`:
- –®—Ç—Ä–∞—Ñ, –µ—Å–ª–∏ **train –Ω–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ val** (—É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ)
- –û—Å–æ–±–µ–Ω–Ω–æ —Å–∏–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ, –µ—Å–ª–∏ train –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π, –∞ val –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π
- –®—Ç—Ä–∞—Ñ –∑–∞ —Ä–∞–∑–Ω–∏—Ü—É –≤ return –∏ Sharpe

**–ü—Ä–∏–º–µ—Ä:**
- Train return: +10%, Val return: -5% ‚Üí —à—Ç—Ä–∞—Ñ ~7500
- Train Sharpe: +5, Val Sharpe: -2 ‚Üí —à—Ç—Ä–∞—Ñ ~140

### 3. –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculate_stability_penalty`:
- –®—Ç—Ä–∞—Ñ –∑–∞ **–±–æ–ª—å—à—É—é —Ä–∞–∑–Ω–∏—Ü—É** –º–µ–∂–¥—É train –∏ val –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –î–∞–∂–µ –µ—Å–ª–∏ –æ–±–µ –º–µ—Ç—Ä–∏–∫–∏ —Ö–æ—Ä–æ—à–∏–µ, –±–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- –ü–æ—Ä–æ–≥–∏:
  - Return —Ä–∞–∑–Ω–∏—Ü–∞ > 10% ‚Üí —à—Ç—Ä–∞—Ñ
  - Sharpe —Ä–∞–∑–Ω–∏—Ü–∞ > 5 ‚Üí —à—Ç—Ä–∞—Ñ
  - Max DD —Ä–∞–∑–Ω–∏—Ü–∞ > 15% ‚Üí —à—Ç—Ä–∞—Ñ

### 4. –ë–æ–Ω—É—Å –∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculate_stability_bonus`:
- –ë–æ–Ω—É—Å, –µ—Å–ª–∏ **train –∏ val –º–µ—Ç—Ä–∏–∫–∏ –±–ª–∏–∑–∫–∏**
- –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü–æ—Ä–æ–≥–∏:
  - Return —Ä–∞–∑–Ω–∏—Ü–∞ < 5% ‚Üí –±–æ–Ω—É—Å +10
  - Sharpe —Ä–∞–∑–Ω–∏—Ü–∞ < 2 ‚Üí –±–æ–Ω—É—Å +5
  - Max DD —Ä–∞–∑–Ω–∏—Ü–∞ < 5% ‚Üí –±–æ–Ω—É—Å +5
  - –û–±–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏ —Ä–∞–∑–Ω–∏—Ü–∞ < 3% ‚Üí –±–æ–Ω—É—Å +15

---

## üìä –§–æ—Ä–º—É–ª–∞ fitness

```python
fitness = val_fitness  # –û—Å–Ω–æ–≤–Ω–æ–π fitness –Ω–∞ validation
        - overfitting_penalty  # –®—Ç—Ä–∞—Ñ –∑–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
        - stability_penalty  # –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
        + stability_bonus  # –ë–æ–Ω—É—Å –∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
        * penalties_multiplier  # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à—Ç—Ä–∞—Ñ—ã (trades, DD, etc.)
        + bonuses  # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–æ–Ω—É—Å—ã (Sharpe, PF, etc.)
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–æ–Ω (6√ó3) –ø–æ–∫–∞–∑–∞–ª:
- ‚úÖ –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –®—Ç—Ä–∞—Ñ—ã –∑–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö)
- ‚úÖ Fitness —Ñ—É–Ω–∫—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É train –∏ val

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:**
```
[Fitness] base=-43.30 overfit_penalty=0.00 stability_penalty=71.40 stability_bonus=0.00 final=-114.70
```

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞ –ì–ê —Å –Ω–æ–≤–æ–π fitness —Ñ—É–Ω–∫—Ü–∏–µ–π –æ–∂–∏–¥–∞–µ–º:

1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è:**
   - Train –∏ Val –º–µ—Ç—Ä–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–ª–∏–∑–∫–∏
   - –†–∞–∑–Ω–∏—Ü–∞ Train-Val < 10% (–≤–º–µ—Å—Ç–æ 33%)

2. **–ë–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**
   - –ú–µ–Ω—å—à–µ —Ä–∞–∑–±—Ä–æ—Å –º–µ–∂–¥—É —Å–ø–ª–∏—Ç–∞–º–∏
   - –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

3. **–£–ª—É—á—à–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫:**
   - Train Return: -5% –¥–æ +5% (–≤–º–µ—Å—Ç–æ -32%)
   - Val Return: +1% –¥–æ +5% (–æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º)
   - Test Return: +2% –¥–æ +6% (–æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º)

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ fitness —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî **–≥–æ—Ç–æ–≤–æ**
2. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –ì–ê (40√ó50) —Å –Ω–æ–≤–æ–π fitness —Ñ—É–Ω–∫—Ü–∏–µ–π
3. ‚è≥ –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∑–∞–ø—É—Å–∫–æ–º
4. ‚è≥ –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —à—Ç—Ä–∞—Ñ–æ–≤/–±–æ–Ω—É—Å–æ–≤

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö:

- `_calculate_overfitting_penalty`: –º–Ω–æ–∂–∏—Ç–µ–ª–∏ 500, 200, 20, 10
- `_calculate_stability_penalty`: –º–Ω–æ–∂–∏—Ç–µ–ª–∏ 100, 2, 50
- `_calculate_stability_bonus`: –∑–Ω–∞—á–µ–Ω–∏—è 10, 5, 15

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø—Ä–µ–∂–¥–µ —á–µ–º –º–µ–Ω—è—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã.

---

**–§–∞–π–ª—ã:**
- `src/core/genetic_optimizer.py` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `docs/ACTION_PLAN_AFTER_GA.md` ‚Äî –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π
- `docs/STAGE0_BASELINE_REPORT.md` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ–µ–≤–æ–≥–æ –ì–ê

