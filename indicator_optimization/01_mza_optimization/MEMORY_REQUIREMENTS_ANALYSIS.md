# üìä –ê–ù–ê–õ–ò–ó –¢–†–ï–ë–û–í–ê–ù–ò–ô –ö –ü–ê–ú–Ø–¢–ò –î–õ–Ø OPTIMIZATION

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —ç—Ç–∞–ø–∞ `stage2_balanced_1h`

### ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç—Ç–∞–ø–∞:
- **–ó–∞–ø–∏—Å–µ–π –¥–∞–Ω–Ω—ã—Ö**: 3,000
- **–ö–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**: 150
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: 16 (–≤—Å–µ)
- **–¢–∞–π–º—Ñ—Ä–µ–π–º**: 1h

### üíæ –†–∞—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏:

#### 1. –î–∞–Ω–Ω—ã–µ –Ω–∞ –æ–¥–∏–Ω —Ç–µ—Å—Ç:
```
DataFrame columns: [timestamp, open, high, low, close, volume]
3000 –∑–∞–ø–∏—Å–µ–π √ó 6 –∫–æ–ª–æ–Ω–æ–∫ √ó 8 –±–∞–π—Ç = 144 KB (–∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

Indicators DataFrame (—Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏):
~30 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ √ó 3000 –∑–∞–ø–∏—Å–µ–π √ó 8 –±–∞–π—Ç ‚âà 720 KB

–°—É–º–º–∞—Ä–Ω–æ –Ω–∞ –æ–¥–Ω—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é: ~1 MB
```

#### 2. –í—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (–ø–∞–º—è—Ç—å –ù–ï –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É):
```
150 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π √ó 1 MB = 150 MB (—Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ)
+ —Å–ª—É–∂–µ–±–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã Python
+ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
+ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

–ò–¢–û–ì–û: ~300-500 MB –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
```

#### 3. –ì–¥–µ –ø—Ä–æ–±–ª–µ–º–∞:
- VectorizedMZAClassifier —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `self.data` –∏ `self.indicators` –≤ –ø–∞–º—è—Ç–∏
- –ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
- –ü–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `gc.collect()` –ø–æ—Å–ª–µ –∫–∞–∂–¥—ã—Ö 20 –∏—Ç–µ—Ä–∞—Ü–∏–π
- –í Python –ø–∞–º—è—Ç—å –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ —Å–∏—Å—Ç–µ–º—É (fragmentation)

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

#### ‚úÖ –†–ï–®–ï–ù–ò–ï 1: –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
–ò–∑–º–µ–Ω–∏—Ç—å –≤ `staged_optimization.py`:
```python
'stage2_balanced_1h': {
    'combinations': 100,  # –≤–º–µ—Å—Ç–æ 150
    'data_samples': 2500,  # –≤–º–µ—Å—Ç–æ 3000
}
```

#### ‚úÖ –†–ï–®–ï–ù–ò–ï 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```python
'stage2_balanced_1h': {
    'all_params': False,  # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ 12 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    'combinations': 150,
}
```

#### ‚úÖ –†–ï–®–ï–ù–ò–ï 3: –ë–æ–ª–µ–µ —á–∞—Å—Ç–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏
–ò–∑–º–µ–Ω–∏—Ç—å –≤ `mza_parameter_optimizer.py` —Å—Ç—Ä–æ–∫—É 321:
```python
if i > 0 and i % 10 == 0:  # –≤–º–µ—Å—Ç–æ 20
    gc.collect()
```

#### ‚úÖ –†–ï–®–ï–ù–ò–ï 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ª–µ–≥–∫–∏–π —Ä–µ–∂–∏–º
–ó–∞–ø—É—Å—Ç–∏—Ç—å `stage1_quick_test` (50 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π, 2000 –∑–∞–ø–∏—Å–µ–π) - —Ç—Ä–µ–±—É–µ—Ç ~100 MB

### üí∞ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –æ–±—ä–µ–º RAM –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –≠—Ç–∞–ø | –ó–∞–ø–∏—Å–µ–π | –ö–æ–º–±–∏–Ω–∞—Ü–∏–π | –¢—Ä–µ–±—É–µ–º–∞—è RAM |
|------|---------|------------|---------------|
| stage1_quick_test | 2000 | 50 | ~100 MB |
| stage2_balanced_1h | 3000 | 150 | **~500 MB** ‚ö†Ô∏è |
| stage3_balanced_4h | 3000 | 150 | **~500 MB** |
| stage4_deep_1h | 4000 | 200 | **~800 MB** ‚ö†Ô∏è‚ö†Ô∏è |
| stage5_deep_4h | 4000 | 200 | **~800 MB** |
| stage6_additional | 3000 | 100 | ~400 MB |

**–ò–¢–û–ì–û –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: ~3-4 GB RAM

### üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è stage2:

**–í–ê–†–ò–ê–ù–¢ A: –£–º–µ–Ω—å—à–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É** (—Å–Ω–∏–∂–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ ~5-10%):
```python
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ notebook:
staged_optimizer.stages['stage2_balanced_1h']['combinations'] = 100
staged_optimizer.stages['stage2_balanced_1h']['data_samples'] = 2500
staged_optimizer.run_stage('stage2_balanced_1h')
```

**–í–ê–†–ò–ê–ù–¢ B: –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
1. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å `stage1_quick_test` (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
2. –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π `stage2` (100 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π)
3. –ï—Å–ª–∏ –ø–∞–º—è—Ç–∏ —Ö–≤–∞—Ç–∏—Ç - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é

**–í–ê–†–ò–ê–ù–¢ C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```python
staged_optimizer.stages['stage2_balanced_1h']['all_params'] = False  # 12 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–º–µ—Å—Ç–æ 16
staged_optimizer.run_stage('stage2_balanced_1h')
```


